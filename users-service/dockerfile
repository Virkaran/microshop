# ====== BUILD STAGE ======
FROM node:20-alpine AS build

WORKDIR /app
COPY package*.json ./

# npm ci fails if package-lock.json is missing
RUN npm ci --only=production

COPY src ./src

# ====== RUNTIME STAGE (TINY IMAGE) ======
FROM node:20-alpine

WORKDIR /app

# Copy only necessary files from build stage
COPY --from=build /app/node_modules ./node_modules
COPY --from=build /app/src ./src
COPY package*.json ./

EXPOSE 8080
CMD ["node", "src/index.js"]
